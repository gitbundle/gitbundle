# Application name (used as the GitBundle service identifier).
# Default: GitBundle
GITBUNDLE_APP_NAME=GitBundle

# Instance ID. If not supplied the machine's hostname is used.
# NOTE: If the value is not provided the hostname of the machine is used.
GITBUNDLE_INSTANCE_ID=

# Enable DEBUG level logging. For better performance set false.
GITBUNDLE_DEBUG=false

# Enable TRACE level logging. For better performance set false.
GITBUNDLE_TRACE=false

# Maximum time to wait for the server gracefully shutdown.
# Default: 5m
GITBUNDLE_GRACEFUL_SHUTDOWN_TIMEOUT=5m

# Allow users to sign‑up themselves.
GITBUNDLE_USER_SIGNUP_ENABLED=false

# Enable nested groups.
GITBUNDLE_NESTED_GROUPS_ENABLED=false

# Allow creation of publicly accessible resources.
# Default: true
GITBUNDLE_PUBLIC_RESOURCE_CREATION_ENABLED=true


# -----------------------------------------------------------------
# URL configuration (external entry points)
# -----------------------------------------------------------------
# Base URL used to build external URLs when not explicitly set.
GITBUNDLE_URL_BASE=

# External URL for the Git HTTP API.
# eg: https://example.gitbundle.com
GITBUNDLE_URL_GIT=

# External URL for the Git SSH server.
# eg: ssh://example.gitbundle.com
GITBUNDLE_URL_GIT_SSH=

# External URL for the REST API (must end with /api after any proxy rewrites).
GITBUNDLE_URL_API=

# External URL for the UI.
GITBUNDLE_URL_UI=

# Internal URL used by the service itself.
GITBUNDLE_URL_INTERNAL=

# Endpoint used by containers to reach the host (e.g. host.docker.internal).
GITBUNDLE_URL_CONTAINER=


# -----------------------------------------------------------------
# Git configuration
# -----------------------------------------------------------------
# Git storage backend (currently only `local` is supported).
# Default: local
GITBUNDLE_GIT_STORAGE_PROVIDER=local

# Default branch name for new repositories.
# Default: main
GITBUNDLE_GIT_DEFAULT_BRANCH=main

# Root directory for all Git‑related data (repos, objects, …).
# Default: ~/.gitbundle
GITBUNDLE_GIT_ROOT=~/.gitbundle

# Path to the executable used as the Git hook (filled automatically at runtime).
# Default: ~/.gitbundle/blob
GITBUNDLE_GIT_HOOK_PATH=~/.gitbundle/blob


# -----------------------------------------------------------------
# Encrypter configuration (sensitive data encryption)
# -----------------------------------------------------------------
# Secret key (32 bytes) for Aes256Gcm encryption; empty disables encryption.
GITBUNDLE_ENCRYPTER_SECRET=
# When encrypt or decrypt failed, return the raw content.
# Default: false
GITBUNDLE_ENCRYPTER_MIXED_CONTENT=false

# -----------------------------------------------------------------
# HTTP server configuration
# -----------------------------------------------------------------
# Address to bind the HTTP server to (default 0.0.0.0 = all interfaces).
GITBUNDLE_HTTP_HOST=0.0.0.0

# Port for the HTTP server (default 8080). HTTPS will use this + 443.
GITBUNDLE_HTTP_PORT=8080

# TLS certificate path for HTTPS (auto‑generated if empty).
GITBUNDLE_HTTP_CERT=

# TLS private key path for HTTPS (auto‑generated if empty).
GITBUNDLE_HTTP_KEY=


# -----------------------------------------------------------------
# SSH server configuration
# -----------------------------------------------------------------
# Enable the SSH server.
# Default: true
GITBUNDLE_SSH_ENABLE=true

# Address to bind the SSH server to.
# Default: 0.0.0.0
GITBUNDLE_SSH_HOST=0.0.0.0

# Port for the SSH server.
# Default: 8022
GITBUNDLE_SSH_PORT=8022

# Default username for generating URLs like `{user}@host:path`.
# Default: git
GITBUNDLE_SSH_DEFAULT_USER=git

# List of allowed SSH cipher suites (comma‑separated). Leave empty for defaults.
GITBUNDLE_SSH_CIPHERS=

# List of allowed SSH key‑exchange algorithms (comma‑separated).
GITBUNDLE_SSH_KEY_EXCHANGES=

# List of allowed SSH MAC algorithms (comma‑separated).
GITBUNDLE_SSH_MACS=

# Paths to the server host private keys (comma‑separated, may contain several keys).
GITBUNDLE_SSH_SERVER_HOST_KEYS=

# Keep‑alive interval for SSH connections.
# Default: 5s
GITBUNDLE_SSH_KEEPALIVE_INTERVAL=5s

# Path to the SSH server private key file.
# Default: ssh/gitbundle.rsa
GITBUNDLE_SSH_SERVER_KEY_PATH=ssh/gitbundle.rsa


# -----------------------------------------------------------------
# Database configuration
# -----------------------------------------------------------------
# Name of the database.
# Default: gitbundle
GITBUNDLE_DATABASE_NAME=gitbundle

# Database connection URL.
# mysql://root:root@localhost:3306 (not well tested)
# postgres://root:root@localhost:5432 (recommended)
# sqlite:./sqlite.db?mode=rwc (not well tested)
#
# Default: sqlite:./sqlite.db?mode=rwc
GITBUNDLE_DATABASE_URL=sqlite:./sqlite.db?mode=rwc


# -----------------------------------------------------------------
# Blob store configuration
# -----------------------------------------------------------------
# Backend provider for blob storage (currently only `filesystem`).
# Default: filesystem
GITBUNDLE_BLOB_STORE_PROVIDER=filesystem

# When using filesystem, this is the directory path where files are stored.
GITBUNDLE_BLOB_STORE_BUCKET=

# Path to the service‑account key file for GCS (ignored for filesystem).
GITBUNDLE_BLOB_STORE_KEY_PATH=


# -----------------------------------------------------------------
# Token (authentication) configuration
# -----------------------------------------------------------------
# Cookie name that stores the token.
# Default: token
GITBUNDLE_TOKEN_COOKIE_NAME=token

# Cookie expiration duration.
# Default: 720h (30 days)
GITBUNDLE_TOKEN_EXPIRE=720h


# -----------------------------------------------------------------
# System bot user configuration
# -----------------------------------------------------------------
# UID of the system bot.
# Default: gitbundle-system-default
GITBUNDLE_USER_SYSTEM_UID=gitbundle-system-default

# Display name of the system bot.
# Default: GitBundle System Default
GITBUNDLE_USER_SYSTEM_DISPLAY_NAME=GitBundle System Default

# Email address of the system bot.
# Default: gitbundle-system-default@example.com
GITBUNDLE_USER_SYSTEM_EMAIL=gitbundle-system-default@example.com


# -----------------------------------------------------------------
# Action bot user configuration
# -----------------------------------------------------------------
# UID of the action bot.
# Default: gitbundle-action-default
GITBUNDLE_USER_ACTION_UID=gitbundle-action-default

# Display name of the action bot.
# Default: GitBundle Action Default
GITBUNDLE_USER_ACTION_DISPLAY_NAME=GitBundle Action Default

# Email address of the action bot.
# Default: gitbundle-action-default@example.com
GITBUNDLE_USER_ACTION_EMAIL=gitbundle-action-default@example.com


# -----------------------------------------------------------------
# Admin user configuration
# -----------------------------------------------------------------
# UID of the default admin.
# Default: root
GITBUNDLE_USER_ADMIN_UID=root

# Display name of the admin.
# Default: Root Administrator
GITBUNDLE_USER_ADMIN_DISPLAY_NAME=Root Administrator

# Email address of the admin (optional).
GITBUNDLE_USER_ADMIN_EMAIL=

# Password of the admin (optional). If empty, the admin user is not auto‑created.
GITBUNDLE_USER_ADMIN_PASSWORD=


# -----------------------------------------------------------------
# CI logs configuration
# -----------------------------------------------------------------
# Provider for CI logs storage (`database` or `s3`).
# Default: database
GITBUNDLE_LOGS_PROVIDER=database

# ----- S3 specific fields (only used when LOGS_PROVIDER = s3) -----
GITBUNDLE_LOGS_S3_BUCKET=
GITBUNDLE_LOGS_S3_PREFIX=
GITBUNDLE_LOGS_S3_ENDPOINT=
# Use path‑style URLs for S3 (true/false). Default: false
GITBUNDLE_LOGS_S3_PATH_STYLE=false


# -----------------------------------------------------------------
# CORS configuration
# -----------------------------------------------------------------
# Allowed origins (comma‑separated). Default: *
GITBUNDLE_CORS_ALLOWED_ORIGINS=*

# Allowed HTTP methods (comma‑separated). Default: GET,POST,PATCH,PUT,DELETE,OPTIONS
GITBUNDLE_CORS_ALLOWED_METHODS=GET,POST,PATCH,PUT,DELETE,OPTIONS

# Allowed request headers (comma‑separated).
GITBUNDLE_CORS_ALLOWED_HEADERS=Origin,Accept,Accept-Language,Authorization,Content-Type,Content-Language,X-Requested-With,X-Request-Id

# Headers exposed to browsers. Default: Link
GITBUNDLE_CORS_EXPOSED_HEADERS=Link

# Whether credentials (cookies, auth headers) are allowed. Default: true
GITBUNDLE_CORS_ALLOW_CREDENTIALS=true

# Max‑age (in seconds) for pre‑flight request caching. Default: 300
GITBUNDLE_CORS_MAX_AGE=300


# -----------------------------------------------------------------
# Redis configuration
# -----------------------------------------------------------------
# Deployment mode (`standalone`, `sentinel`, `cluster`). Only standalone currently supported.
GITBUNDLE_REDIS_MODE=standalone

# Maximum retry attempts (cluster mode only). Default: 3
GITBUNDLE_REDIS_MAX_RETRIES=3

# Username for Redis AUTH (optional).
GITBUNDLE_REDIS_USERNAME=

# Password for Redis AUTH (optional).
GITBUNDLE_REDIS_PASSWORD=

# Username for Sentinel AUTH (optional).
GITBUNDLE_REDIS_SENTINEL_USERNAME=

# Password for Sentinel AUTH (optional).
GITBUNDLE_REDIS_SENTINEL_PASSWORD=

# Endpoint for a single Redis instance (e.g. localhost:6379).
GITBUNDLE_REDIS_ENDPOINT=localhost:6379

# List of node endpoints for cluster mode (comma‑separated).
GITBUNDLE_REDIS_CLUSTER_ENDPOINTS=

# Master name for Sentinel mode.
GITBUNDLE_REDIS_SENTINEL_MASTER=

# Replica name for Sentinel mode.
GITBUNDLE_REDIS_SENTINEL_REPLICA=

# Sentinel endpoints (comma‑separated) for Sentinel mode.
GITBUNDLE_REDIS_SENTINEL_ENDPOINTS=


# -----------------------------------------------------------------
# Events system configuration
# -----------------------------------------------------------------
# Backend for the event system (`memory` or `redis`). Default: memory
GITBUNDLE_EVENTS_PROVIDER=memory

# Event group name (used to isolate events in shared Redis instances).
# Default: gitbundle
GITBUNDLE_EVENTS_GROUP=gitbundle

# Maximum length of a single stream. Default: 10000
GITBUNDLE_EVENTS_MAX_STREAM_LENGTH=10000

# Use approximate trimming (`XTRIM ~`) if true. Default: true
GITBUNDLE_EVENTS_APPROX_MAX_STREAM_LENGTH=true


# -----------------------------------------------------------------
# Distributed lock configuration
# -----------------------------------------------------------------
# Provider for distributed locks (`memory` or `redis`). Default: memory
GITBUNDLE_LOCK_PROVIDER=memory

# Default lock expiration time. Default: 8s
GITBUNDLE_LOCK_EXPIRY=8s

# Number of attempts to acquire a lock. Default: 3
GITBUNDLE_LOCK_TRIES=3

# Delay between lock retry attempts. Default: 250ms
GITBUNDLE_LOCK_RETRY_DELAY=250ms

# Drift factor used when calculating lock expiration. Default: 0.01
GITBUNDLE_LOCK_DRIFT_FACTOR=0.01

# Timeout factor used when calculating lock timeout. Default: 0.25
GITBUNDLE_LOCK_TIMEOUT_FACTOR=0.25

# Prefix for lock keys (helps avoid key collisions). Default: gitbundle
GITBUNDLE_LOCK_APP_GROUP=gitbundle

# Default group used when a lock does not specify its own group. Default: default
GITBUNDLE_LOCK_DEFAULT_GROUP=default


# -----------------------------------------------------------------
# Pub/Sub configuration
# -----------------------------------------------------------------
# Provider for pub/sub (`memory` or `redis`). Default: memory
GITBUNDLE_PUBSUB_PROVIDER=memory

# Prefix for pub/sub keys (helps avoid collisions). Default: gitbundle
GITBUNDLE_PUBSUB_APP_GROUP=gitbundle

# Default group used if a channel does not specify one. Default: default
GITBUNDLE_PUBSUB_DEFAULT_GROUP=default

# Health‑check interval for the pub/sub service. Default: 3s
GITBUNDLE_PUBSUB_HEALTH_INTERVAL=3s

# Timeout for sending a message. Default: 60s
GITBUNDLE_PUBSUB_SEND_TIMEOUT=60s

# Channel buffer size. Default: 100
GITBUNDLE_PUBSUB_CHANNEL_SIZE=100


# -----------------------------------------------------------------
# Background jobs configuration
# -----------------------------------------------------------------
# Maximum number of background jobs that may run concurrently. Default: 10
GITBUNDLE_BACKGROUND_JOBS_MAX_RUNNING=10

# Retention time for finished/failed jobs. Default: 120h
GITBUNDLE_BACKGROUND_JOBS_RETENTION_TIME=120h


# -----------------------------------------------------------------
# Webhook configuration (NOT READY YET)
# -----------------------------------------------------------------
# Identifier used for the `User-Agent` header (no version). Default: GitBundle
GITBUNDLE_WEBHOOK_USER_AGENT_IDENTITY=GitBundle

# Identifier used for custom webhook headers (e.g. X‑GitBundle‑Trigger). If empty, falls back to the User‑Agent.
GITBUNDLE_WEBHOOK_HEADER_IDENTITY=

# Number of webhooks that can run concurrently. Default: 4
GITBUNDLE_WEBHOOK_CONCURRENCY=4

# Maximum retries for a single webhook. Default: 3
GITBUNDLE_WEBHOOK_MAX_RETRIES=3

# Allow webhook calls to private network addresses. Default: false
GITBUNDLE_WEBHOOK_ALLOW_PRIVATE_NETWORK=false

# Allow webhook calls to loopback addresses (127.0.0.1, ::1). Default: false
GITBUNDLE_WEBHOOK_ALLOW_LOOPBACK=false

# Retention period for webhook execution records. Default: 168h (7 days)
GITBUNDLE_WEBHOOK_RETENTION_TIME=168h


# -----------------------------------------------------------------
# Repository size statistics configuration
# -----------------------------------------------------------------
# Enable repository size calculation job. Default: true
GITBUNDLE_REPO_SIZE_ENABLED=true

# Cron expression for the size calculation job. Default: 0 0 * * *
GITBUNDLE_REPO_SIZE_CRON="0 0 * * *"

# Maximum duration a size calculation may run. Default: 15m
GITBUNDLE_REPO_SIZE_MAX_DURATION=15m

# Number of worker threads for size calculation. Default: 5
GITBUNDLE_REPO_SIZE_NUM_WORKERS=5

# Default repository size limit in bytes. Default: 104857600 (100 MiB)
GITBUNDLE_REPO_SIZE_LIMIT=104857600


# -----------------------------------------------------------------
# CODEOWNERS configuration
# -----------------------------------------------------------------
# Paths to look for CODEOWNERS files inside each repository (comma‑separated).
# Default: CODEOWNERS,.gitbundle/CODEOWNERS
GITBUNDLE_CODEOWNERS_FILE_PATHS=CODEOWNERS,.gitbundle/CODEOWNERS


# -----------------------------------------------------------------
# SMTP configuration (email sending)
# -----------------------------------------------------------------

# SMTP connection mode.
#
# This option controls how the application establishes the SMTP
# connection when using the built-in SMTP client.
#
# NOTES:
#   REQUIRED when `GITBUNDLE_SMTP_CERT_PATH` is NOT set.
#   MUST NOT be set when `GITBUNDLE_SMTP_CERT_PATH` IS set.
#
# Supported values:
#
# - tls
#   Connect directly using TLS/SSL.
#   Commonly used with port 465.
#   Internally corresponds to lettre::SmtpTransport::relay()
#   with Tls::Required.
#
# - starttls
#   Connect in plaintext first, then upgrade to TLS via STARTTLS.
#   Commonly used with port 587.
#   Internally corresponds to lettre::SmtpTransport::starttls_relay().
#
# Example:
#   GITBUNDLE_SMTP_MODE=tls
#
GITBUNDLE_SMTP_MODE=

# SMTP server hostname.
#
# The DNS hostname or IP address of the SMTP server.
#
# Examples:
#   smtp.gmail.com
#
GITBUNDLE_SMTP_HOST=

# SMTP server port.
#
# NOTES:
#   REQUIRED when `GITBUNDLE_SMTP_CERT_PATH` IS set.
#   MUST NOT be set when `GITBUNDLE_SMTP_CERT_PATH` is NOT set.
#
# This is only used when a custom CA or self-signed certificate
# is provided via `GITBUNDLE_SMTP_CERT_PATH`.
#
# Example:
#   GITBUNDLE_SMTP_PORT=465
#
GITBUNDLE_SMTP_PORT=

# SMTP authentication username.
#
# Usually the full email address or account name required
# by the SMTP provider.
GITBUNDLE_SMTP_USERNAME=

# SMTP authentication password.
#
# This is the password or SMTP authorization token for the account.
#
# WARNING:
#   Avoid committing this value into version control.
#   Use environment variables or secret managers instead.
#
GITBUNDLE_SMTP_PASSWORD=

# Sender email address.
#
# This address will be used as the "From" field when sending emails.
#
# Example:
#   no-reply@example.com
#
GITBUNDLE_SMTP_FROM_MAIL=

# Path to a custom CA or self-signed certificate in PEM format.
#
# (NOTES) When this option IS set:
# - A custom TLS configuration is used
# - `GITBUNDLE_SMTP_MODE` MUST NOT be set
# - `GITBUNDLE_SMTP_PORT` MUST be provided
#
# (NOTES) When this option is NOT set:
# - Standard SMTP relay / STARTTLS mode is used
# - `GITBUNDLE_SMTP_MODE` MUST be provided
# - `GITBUNDLE_SMTP_PORT` MUST NOT be set
#
# This is typically required for:
# - Internal mail servers
# - Self-hosted SMTP services
# - Private CA or self-signed certificates
#
# Example:
#   GITBUNDLE_SMTP_CERT_PATH=/etc/ssl/certs/internal-mail.pem
#
GITBUNDLE_SMTP_CERT_PATH=


# -----------------------------------------------------------------
# Notification configuration, (NOT READY YET)
# -----------------------------------------------------------------
# Maximum retries for each notification. Default: 3
GITBUNDLE_NOTIFICATION_MAX_RETRIES=3

# Number of notifications that can be processed concurrently. Default: 4
GITBUNDLE_NOTIFICATION_CONCURRENCY=4


# -----------------------------------------------------------------
# Keyword search configuration
# -----------------------------------------------------------------
# Backend provider for keyword search (`local`, `elastic`, …). Default: local
GITBUNDLE_KEYWORD_SEARCH_PROVIDER=local

# Number of concurrent search workers. Default: 4
GITBUNDLE_KEYWORD_SEARCH_CONCURRENCY=4

# Maximum retries for a search operation. Default: 3
GITBUNDLE_KEYWORD_SEARCH_MAX_RETRIES=3


# -----------------------------------------------------------------
# Repository management configuration
# -----------------------------------------------------------------
# Retention time for deleted repositories. Default: 2160h (90 days)
GITBUNDLE_REPOS_DELETED_RETENTION_TIME=2160h


# -----------------------------------------------------------------
# Stream (message‑queue) configuration
# -----------------------------------------------------------------
# Number of Tokio tasks handling the stream. Default: 2
GITBUNDLE_STREAM_CONCURRENCY=2

# Maximum idle time before an unacknowledged message can be claimed by another consumer.
# Default: 60s
GITBUNDLE_STREAM_IDLE_TIMEOUT=60s

# Maximum retry count for a stream message. Default: 3
GITBUNDLE_STREAM_MAX_RETRIES=3


# -----------------------------------------------------------------
# Runner (job executor) configuration
# -----------------------------------------------------------------
# Cache provider used by runners (`memory` or `redis`). Default: memory
GITBUNDLE_RUNNER_CACHE_PROVIDER=memory

# Maximum idle time before a runner is considered offline. Default: 90s
GITBUNDLE_RUNNER_IDLE_TIMEOUT=90s

# Long‑poll timeout when a runner's queue is empty (how long it waits for a new job).
# Default: 60s
GITBUNDLE_RUNNER_POLL_TIMEOUT=60s

# Whether to automatically fail‑over to another runner when the current one goes offline.
# Default: true
GITBUNDLE_RUNNER_FAILOVER=true

# TTL for cached job keys when Redis is used. Default: 24h
GITBUNDLE_RUNNER_REDIS_TTL=24h

# Prefix for all Redis keys used by the runner subsystem. Default: gitbundle-runner
GITBUNDLE_RUNNER_REDIS_KEYPREFIX=gitbundle-runner

# -----------------------------------------------------------------
# Verification configuration
#
# Controls how one-time authentication tokens are generated,
# protected, stored, and validated.
#
# These tokens are used for:
# - Email verification
# - Password reset
# -----------------------------------------------------------------

# Backend provider used to store one-time authentication tokens.
#
# Supported values:
#   - memory : In-memory storage (single-node, non-persistent)
#              Recommended for standalone or development setups.
#
#   - redis  : Redis-backed storage
#              Required for clustered or multi-instance deployments.
#
# Default: memory
#
# NOTE:
# When using "memory", all verification tokens are lost on process
# restart.
#
#GITBUNDLE_VERIFICATION_PROVIDER=memory
GITBUNDLE_VERIFICATION_PROVIDER=

# Secret used to enable cryptographic protection for one-time
# authentication tokens.
#
# When set, this value is used to derive a symmetric encryption key
# (AES-256-GCM) that provides confidentiality and integrity protection.
#
# SECURITY WARNING:
# If this value is NOT set, verification tokens are NOT encrypted.
# Only a base64 encoding of partial user-identifying information is used.
#
# This mode provides NO cryptographic security and MUST NOT be used
# in production environments.
#
# Changing this value will immediately invalidate all previously
# issued verification tokens.
#
# Production deployments MUST configure a strong, high-entropy secret.
#
# Example (recommended for production):
#   GITBUNDLE_VERIFICATION_SECRET="$(openssl rand -base64 24 | tr -d '\n')"
#
GITBUNDLE_VERIFICATION_SECRET=

# Maximum time-to-live (TTL) for one-time authentication tokens.
#
# Tokens expire automatically after this duration and cannot be reused.
#
# The value MUST be a valid human-readable duration string,
# for example:
#   - 10m   (10 minutes)
#   - 1h    (1 hour)
#   - 30s   (30 seconds)
#
# Default: 10m
#
# SECURITY NOTE:
# Shorter TTL values reduce the risk of token leakage but may
# impact user experience.
#
GITBUNDLE_VERIFICATION_TTL=10m
